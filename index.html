<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBookPirates</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    
</head>
<body>

    <div id="appContainer">
    
    <div id="login-view">
        <h2>Bel√©p√©s a Kik√∂t≈ëbe</h2>
        <form id="loginForm" autocomplete="on">
            <input type="text" id="name" name="username" placeholder="Mi a kal√≥zneved?" required autocomplete="username">
            <div class="password-container">
                <input type="password" id="jelszo" name="password" placeholder="Mi a kedvenc √©teled?" required autocomplete="current-password">
                <i class="fas fa-eye" id="togglePassword"></i>
            </div>
            <button type="button" onclick="login()">Besz√°ll√°s</button>
        </form>
        <p id="login-status" style="color: red;"></p>
        <div id="registerButtonContainer"></div>
    </div>

    <div id="app-view">
        <div id="header">
            <span class="header-title">eBookPirates</span>
            
            <div id="header-stats">
                <div id="creditCell" class="header-stat-item" title="Kreditegyenleg friss√≠t√©se">
                    <i class="fas fa-coins"></i> <span id="creditValue">0</span>
                </div>
                <div id="libraryLink" class="header-stat-item" title="K√∂nyvt√°r">
                    <i class="fas fa-book"></i> <span class="stat-label">K√∂nyvt√°r</span>
                </div>
                <div id="treasuresLink" class="header-stat-item" title="Kincsek">
                    <i class="fas fa-gem"></i> <span class="stat-label">Kincsek</span>
                </div>
            </div>
            
            <div class="header-close-icon" onclick="loadPage('kikoto_oldal')" title="Vissza a kik√∂t≈ëbe">
                <i class="fas fa-times"></i>
            </div>
        </div>

        <div id="content"></div>
    </div>

    <div id="loading-overlay">
        <img id="loading-gif" src="" alt="Bet√∂lt√©s..."/>
        <p>Kis t√ºrelmet, kal√≥z...</p>
    </div>

    <div id="marketing-view" style="display: none;">
        <div style="text-align: center; margin-bottom: 30px;">
            <h2 style="color: #8b0000; font-family: 'Pirata One', serif; font-size: 2.5em;">A Zs√°km√°ny √ârt√©kel√©se</h2>
            <p>Minden v√°laszod <strong>1 Kal√≥zkreditet</strong> √©r!</p>
        </div>
        
        <form id="marketing-form" onsubmit="return false;">
            <div id="marketing-questions-area"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button type="button" class="btn btn-primary" onclick="submitMarketingForm()" style="font-size: 1.2em; padding: 15px 40px; background-color: #8b0000; border: none;">
                    V√©lem√©ny Bek√ºld√©se & Kreditek Zsebret√©tele
                </button>
                <button type="button" class="btn btn-secondary" onclick="returnToPort()" style="font-size: 1.2em; padding: 15px 30px; margin-left: 10px; background-color: #666; border: none; color: white;">
                    M√©gse
                </button>
            </div>
        </form>
    </div>

    <div id="author-dashboard-modal" class="gamemode-modal" style="display: none; align-items: flex-start; overflow-y: auto; z-index: 100;">
        <div class="gamemode-modal-content" style="margin-top: 5vh; max-width: 900px; width: 95%;">
            
            <div class="gamemode-header">
                <span id="dashboard-book-title" class="header-title">K√∂nyv Statisztika</span>
                <span class="close-modal-btn" onclick="document.getElementById('author-dashboard-modal').style.display='none'">&times;</span>
            </div>

            <div id="dashboard-loading" style="padding: 20px; text-align: center;">
                <i class="fas fa-spinner fa-spin"></i> Adatok bet√∂lt√©se a krist√°lyg√∂mbb≈ël...
            </div>

            <div id="dashboard-content" style="display: none; padding: 20px;">
                
                <div id="dashboard-header-summary" style="margin-bottom: 25px; padding: 15px; background: #fff8dc; border: 1px solid #d2b48c; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                    <h4 style="margin-top:0; color:#8b4513; border-bottom:1px dashed #ccc; padding-bottom:5px;">
                        <i class="fas fa-list-alt"></i> Akt√≠v Alapk√©rd√©sek (Ezekre v√°laszol az olvas√≥)
                    </h4>
                    <div id="base-questions-grid" style="display: flex; flex-wrap: wrap; gap: 10px;">
                    </div>
                </div>

                <div class="stats-summary-box" style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div class="stat-card">
                        <h3>√ñsszes V√°lasz</h3>
                        <p id="stat-total-responses" style="font-size: 2em; font-weight: bold; color: #2c5282;">0</p>
                    </div>
                </div>
                
                <div class="tab-container" style="border-bottom: 2px solid #ddd; margin-bottom: 20px;">
                    <button class="tab-button active" onclick="openDashboardTab(event, 'DashStats')">üìä Eredm√©nyek</button>
                    <button class="tab-button" onclick="openDashboardTab(event, 'DashVerification')">üõ°Ô∏è Ellen≈ërz√©s (Kv√≠z)</button>
                    <button class="tab-button" onclick="openDashboardTab(event, 'DashSettings')">‚öôÔ∏è √öj K√©rd√©s</button>
                </div>

                <div id="DashStats" class="tab-content" style="display: block;">
                    <div id="dashboard-details-list"></div>
                </div>

                <div id="DashVerification" class="tab-content" style="display: none;">
                    <div style="background: #f0fff4; border: 1px solid #c6f6d5; padding: 20px; border-radius: 8px;">
                        <h3 style="color: #276749; margin-top: 0;">üßê Olvasotts√°gi Pr√≥ba (Anti-Csal√°s V√©delem)</h3>
                        <p>Itt √°ll√≠thatsz be 3 k√©rd√©st, amire <strong>csak az tudja a v√°laszt, aki t√©nyleg olvasta a m≈±vet.</strong></p>
                        <p style="font-size: 0.9em; color: #555;"><i>A rendszer ezeket "verify" t√≠pusk√©nt menti el. A statisztik√°ba nem ker√ºlnek bele, csak a kapu≈ërz≈ë funkci√≥t l√°tj√°k el.</i></p>
                        <hr>

                        <form id="verification-quiz-form">
                            <div class="quiz-setup-item" style="margin-bottom: 15px; background: white; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                                <label><strong>1. Ellen≈ërz≈ë K√©rd√©s:</strong></label>
                                <input type="text" id="v-q1-text" class="quiz-q-text" placeholder="K√©rd√©s sz√∂vege..." style="width: 100%; margin-bottom: 5px;">
                                <div style="display: flex; gap: 10px;">
                                    <select class="quiz-q-type" style="padding: 5px; background:#eee;" disabled>
                                        <option value="text" selected>Sz√∂veges v√°lasz</option>
                                    </select>
                                    <input type="text" id="v-q1-ans" class="quiz-q-answer" placeholder="Helyes v√°lasz (kulcssz√≥)" style="flex-grow: 1; border: 2px solid #276749;">
                                </div>
                            </div>

                            <div class="quiz-setup-item" style="margin-bottom: 15px; background: white; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                                <label><strong>2. Ellen≈ërz≈ë K√©rd√©s:</strong></label>
                                <input type="text" id="v-q2-text" class="quiz-q-text" placeholder="K√©rd√©s sz√∂vege..." style="width: 100%; margin-bottom: 5px;">
                                <div style="display: flex; gap: 10px;">
                                    <select class="quiz-q-type" style="padding: 5px; background:#eee;" disabled>
                                        <option value="text" selected>Sz√∂veges v√°lasz</option>
                                    </select>
                                    <input type="text" id="v-q2-ans" class="quiz-q-answer" placeholder="Helyes v√°lasz (kulcssz√≥)" style="flex-grow: 1; border: 2px solid #276749;">
                                </div>
                            </div>

                            <div class="quiz-setup-item" style="margin-bottom: 15px; background: white; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                                <label><strong>3. Ellen≈ërz≈ë K√©rd√©s:</strong></label>
                                <input type="text" id="v-q3-text" class="quiz-q-text" placeholder="K√©rd√©s sz√∂vege..." style="width: 100%; margin-bottom: 5px;">
                                <div style="display: flex; gap: 10px;">
                                    <select class="quiz-q-type" style="padding: 5px; background:#eee;" disabled>
                                        <option value="text" selected>Sz√∂veges v√°lasz</option>
                                    </select>
                                    <input type="text" id="v-q3-ans" class="quiz-q-answer" placeholder="Helyes v√°lasz (kulcssz√≥)" style="flex-grow: 1; border: 2px solid #276749;">
                                </div>
                            </div>

                            <button type="button" class="btn" onclick="submitVerificationQuiz()" style="background-color: #276749; width: 100%; color: white; font-weight: bold; padding: 10px;">
                                üíæ 3 Ellen≈ërz≈ë K√©rd√©s Ment√©se
                            </button>
                        </form>
                    </div>
                </div>

                <div id="DashSettings" class="tab-content" style="display: none;">

                    <div style="margin-bottom: 20px; background: #fff; border: 1px solid #ddd; border-radius: 8px; overflow: hidden;">
                        <div style="background: #f0f4f8; padding: 10px 15px; border-bottom: 1px solid #ddd; font-weight: bold; color: #2c3e50;">
                            <i class="fas fa-clipboard-list"></i> Jelenleg akt√≠v k√©rd√©sek (Ezeket m√°r tartalmazza az ≈±rlap)
                        </div>
                        <div id="existing-questions-list" style="max-height: 200px; overflow-y: auto; padding: 10px;">
                            <p style="color:#888; font-style:italic;">Adatok bet√∂lt√©se...</p>
                        </div>
                    </div>

                    <hr style="border: 0; border-top: 1px dashed #ccc; margin: 20px 0;">

                    <h3>√öj k√©rd√©s hozz√°ad√°sa az ≈±rlaphoz</h3>
                    <p style="font-size: 0.9em; color: #666;">Itt b≈ëv√≠theted a k√©rd≈ë√≠vet. Az √∫j k√©rd√©sek automatikusan megjelennek az √∫j olvas√≥kn√°l.</p>
                    
                    <form id="new-question-form" style="background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
                        <div class="form-group">
                            <label>K√©rd√©s sz√∂vege:</label>
                            <input type="text" id="nq-text" placeholder="Pl. Melyik karakter volt a legszimpatikusabb?" required style="width: 100%; padding: 8px;">
                        </div>
                        
                        <div class="form-group" style="margin-top: 10px;">
                            <label>T√≠pus:</label>
                            <select id="nq-type" style="width: 100%; padding: 8px;">
                                <option value="text">Sz√∂veges kifejt≈ës</option>
                                <option value="rating">Csillagos √©rt√©kel√©s (1-5)</option>
                                <option value="yesno">Igen / Nem</option>
                            </select>
                        </div>

                        <div class="form-group" style="margin-top: 10px;">
                            <label>Kateg√≥ria (J√°t√©khoz):</label>
                            <select id="nq-category" style="width: 100%; padding: 8px;">
                                <option value="general">√Åltal√°nos</option>
                                <option value="story">T√∂rt√©net / Lore</option>
                                <option value="character">Karakterek</option>
                            </select>
                        </div>
                        
                        <div style="margin-top: 10px;">
                            <label><input type="checkbox" id="nq-isgame"> Ez a k√©rd√©s beker√ºlhet kv√≠zk√©rd√©snek a j√°t√©kba?</label>
                        </div>

                        <button type="button" class="btn btn-success" onclick="submitNewQuestion()" style="margin-top: 15px; width: 100%;">Hozz√°ad√°s</button>
                    </form>
                </div>

            </div> 
        </div> 
    </div>

    <div id="universal-npc-modal" class="gamemode-modal" style="display: none; align-items: center; justify-content: center;">
          <div id="npc-portrait-panel" class="npc-portrait-closed">
            <img id="npc-portrait-image" src="" alt="NPC">
          </div>
    <div class="gamemode-modal-content" style="width: 90%; max-width: 500px; height: 80vh; padding: 0; display: flex; flex-direction: column; overflow: hidden; background: #fff;">
        
        <div id="npc-header" style="background: #37474f; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #cfd8dc;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span id="npc-icon" style="font-size: 1.5em;">üëµ</span> <div>
                    <h3 id="npc-name" style="margin: 0; font-family: 'Pirata One', cursive; font-size: 1.4em; color: white; border: none;">Hortenzi Gabrel</h3>
                    <small id="npc-role" style="color: #b0bec5;">Piacf≈ën√∂k</small>
                </div>
            </div>
            <button onclick="document.getElementById('universal-npc-modal').style.display='none'" style="background: transparent; border: none; color: white; font-size: 1.5em; cursor: pointer;">&times;</button>
        </div>

        <div id="universal-chat-area" style="flex: 1; padding: 15px; overflow-y: auto; background-color: #eceff1; display: flex; flex-direction: column; gap: 10px;">
            </div>

        <div style="padding: 10px; background: white; border-top: 1px solid #ccc; display: flex; gap: 5px;">
            <input type="text" id="universal-chat-input" placeholder="Mit akarsz?" style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            <button class="btn" onclick="sendUniversalMessage()" style="background: #37474f; color: white; border: none; padding: 0 15px; border-radius: 4px;">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        
        <input type="hidden" id="current-npc-id" value="">
    </div>
</div>

    <div id="log-entry-modal" class="gamemode-modal" style="display: none; align-items: flex-start; overflow-y: auto;">
        <div class="gamemode-modal-content" style="margin-top: 5vh; max-width: 700px;">
            <span class="close-btn" onclick="closeLogEntryModal()">&times;</span>
            <h4 id="log-modal-title">√öj Haj√≥napl√≥ Bejegyz√©s</h4> 
            <div style="margin-bottom: 15px; text-align: right;">
                <i class="fas fa-info-circle" style="cursor: pointer; font-size: 1.2em;" onclick="toggleLogSplash()"></i>
            </div>
            <div id="log-entry-splash-text" style="display: none; background-color: rgba(0,0,0,0.1); padding: 10px; border-radius: 5px; margin-bottom: 20px; font-size: 0.9em; border: 1px dashed #ccc;">
                <p>A haj√≥napl√≥ a haj√≥ elv√°laszthatatlan, hivatalos dokumentuma. Csakis azok a haj√≥skapit√°nyok vezethetik, akik t√©nylegesen ir√°ny√≠tj√°k a haj√≥t, legyenek ak√°r a haj√≥ tulajdonosai, vagy csup√°n a tulajdonos √°ltal felk√©rt parancsnokai. A napi jelent√©sek be√≠r√°sa a napi rutinjuk k√∂telez≈ë r√©sze, egy sikeres k√∂nyvexped√≠ci√≥ vagy letkrist√°lyvad√°szat ut√°n seg√≠tenek az eml√©kek felid√©z√©s√©ben, a pontos t√©rk√©pek megrajzol√°s√°ban.</p>
            </div>

            <form id="log-entry-form">
                <input type="hidden" id="log-entry-id" value="">

                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <button type="button" id="log-prev-btn" class="btn btn-secondary" style="visibility: hidden;">&lt; El≈ëz≈ë</button>
                    <button type="button" id="log-next-btn" class="btn btn-secondary" style="visibility: hidden;">K√∂vetkez≈ë &gt;</button>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group">
                        <label for="log-date">D√°tum:</label>
                        <input type="date" id="log-date" style="padding: 8px;"> 
                    </div>
                    <div class="form-group">
                        <label for="log-time">Id≈ë (kb.):</label>
                        <input type="time" id="log-time" style="padding: 8px;"> 
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div class="form-group">
                        <label for="log-wind">Sz√©lir√°ny:</label>
                        <select id="log-wind">
                            <option value="">V√°lassz...</option>
                            <option value="√â">√âszak (√â)</option>
                            <option value="√âK">√âszak-Kelet (√âK)</option>
                            <option value="K">Kelet (K)</option>
                            <option value="DK">D√©l-Kelet (DK)</option>
                            <option value="D">D√©l (D)</option>
                            <option value="DNY">D√©l-Nyugat (DNY)</option>
                            <option value="NY">Nyugat (NY)</option>
                            <option value="√âNY">√âszak-Nyugat (√âNY)</option>
                            <option value="V√°ltoz√≥">V√°ltoz√≥</option>
                            <option value="Sz√©lcsend">Sz√©lcsend</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="log-weather">Id≈ëj√°r√°s:</label>
                        <select id="log-weather">
                            <option value="">V√°lassz...</option>
                            <option value="Napos">Napos</option>
                            <option value="Felh≈ës">Felh≈ës</option>
                            <option value="Es≈ës">Es≈ës</option>
                            <option value="Viharos">Viharos</option>
                            <option value="K√∂d√∂s">K√∂d√∂s</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                    <div class="form-group">
                        <label for="log-lat">Sz√©less√©g:</label>
                        <input type="text" id="log-lat" placeholder="Pl. 47.4979">
                    </div>
                    <div class="form-group">
                        <label for="log-lon">Hossz√∫s√°g:</label>
                        <input type="text" id="log-lon" placeholder="Pl. 19.0402">
                    </div>
                    <button type="button" class="btn" onclick="getGeoLocation()" style="padding: 8px 12px; height: fit-content;" title="Poz√≠ci√≥ lek√©r√©se">üìç</button>
                </div>

                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="log-report">Napi jelent√©s:</label>
                    <textarea id="log-report" rows="8" style="width: 100%; box-sizing: border-box; padding: 8px;" placeholder="√çrd le a mai nap esem√©nyeit..."></textarea>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="log-image">K√©p csatol√°sa (opcion√°lis, PNG):</label>
                    <input type="file" id="log-image" accept="image/png">
                    <div id="log-image-preview" style="margin-top: 10px; max-width: 200px;"></div>
                </div>

                <div id="log-entry-status" style="margin-bottom: 15px; color: red; font-weight: bold;"></div>

                <button type="button" id="submit-log-entry-btn" class="btn">Bejegyz√©s ment√©se</button>
                <button type="button" class="btn btn-close" onclick="closeLogEntryModal()">M√©gse</button>
            </form>
        </div>
    </div>

    <div id="monk-pin-modal" class="gamemode-modal" style="display: none; align-items: center;">
        <div class="gamemode-modal-content" style="max-width: 400px; text-align: center;">
            <h3 style="margin-top: 0;">Biztons√°gi Ellen≈ërz√©s</h3>
            <p>A m≈±velet d√≠ja 10 T√°lentum.<br>K√©rlek, add meg a PIN k√≥dodat a folytat√°shoz!</p>
            
            <div style="position: relative; margin: 20px 0; text-align: left;">
                <label for="monk-pin-input" style="font-weight: bold;">PIN K√≥d:</label>
                <div style="position: relative;">
                    <input type="password" id="monk-pin-input" style="width: 100%; padding-right: 40px; box-sizing: border-box;" placeholder="****">
                    <i class="fas fa-eye" id="monk-pin-toggle" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666;"></i>
                </div>
            </div>

            <div style="display: flex; justify-content: space-between; gap: 10px;">
                <button class="btn btn-danger" onclick="closeMonkPinModal()">M√©gse</button>
                <button class="btn btn-success" onclick="finalizeMonkUpload()">Meger≈ës√≠t√©s √©s Felt√∂lt√©s</button>
            </div>
        </div>
    </div>

    <div id="system-message-modal" class="gamemode-modal" style="display: none; z-index: 100; background: rgba(0,0,0,0.85); align-items: center; justify-content: center;">
        <div class="gamemode-modal-content" style="width: 320px; text-align: center; border: 2px solid #d2691e; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.5);">
            
            <div style="margin-bottom: 15px;">
                <i id="sys-modal-icon" class="fas fa-info-circle" style="font-size: 2.5em; color: #8b0000; display:block; margin-bottom: 10px;"></i>
                <h3 id="sys-modal-title" style="color: #5d3a1a; margin: 0; font-family: 'Georgia', serif;">Rendszer√ºzenet</h3>
            </div>

            <div id="sys-modal-body" style="color: #333; font-size: 1em; line-height: 1.5; margin-bottom: 20px;">
            </div>

            <div id="sys-modal-buttons" style="display: flex; justify-content: center; gap: 10px;">
            </div>
        </div>
    </div>

</div>

    <script src="web_fordito.js"></script>
    <script src="app.js"></script>

</body>
